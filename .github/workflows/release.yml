name: Build and Release

on:
  push:
    tags:
      - 'v*'  # DÃ©clenchement uniquement sur un tag versionnÃ© (ex: v1.0.0)

jobs:
  build-release:
    runs-on: windows-latest

    env:
      PROJECT_NAME: AeroHear
      RUNTIME_ID: win-x64
      FRAMEWORK: net8.0-windows
      CONFIGURATION: Release

    steps:
    - name: ðŸ“¥ Cloner le dÃ©pÃ´t
      uses: actions/checkout@v4

    - name: ðŸ§° Installer .NET 8
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: ðŸ› ï¸ Restaurer les dÃ©pendances
      run: dotnet restore

    - name: ðŸ§± Build self-contained .exe
      run: >
        dotnet publish -c ${{ env.CONFIGURATION }}
        -r ${{ env.RUNTIME_ID }}
        --self-contained true
        /p:PublishSingleFile=true
        /p:IncludeAllContentForSelfExtract=true
        /p:PublishTrimmed=false

    - name: ðŸ“¦ CrÃ©er archive ZIP
      run: |
        cd bin\${{ env.CONFIGURATION }}\${{ env.FRAMEWORK }}\${{ env.RUNTIME_ID }}\publish
        Compress-Archive -Path * -DestinationPath ../../../${{ env.PROJECT_NAME }}-portable.zip

    - name: ðŸš€ CrÃ©er une release GitHub avec l'archive
      uses: softprops/action-gh-release@v2
      with:
        files: ./bin/${{ env.CONFIGURATION }}/${{ env.PROJECT_NAME }}-portable.zip
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
